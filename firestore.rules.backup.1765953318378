rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ============================================================================
    // UNIFIED FIRESTORE SECURITY RULES - ALL PROJECTS
    // ============================================================================
    // Supports: Dashboard, Licensing Website, Call Sheet App, EDL Converter, Parser Brain
    // Handles all collections with proper organization-based access control
    // Single source of truth for all Firebase security rules
    // ============================================================================
    
    // ============================================================================
    // HELPER FUNCTIONS
    // ============================================================================
    
    // Authentication check
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Get user's custom claims
    function getUserClaims() {
      return request.auth.token;
    }
    
    // Get organization ID from user claims
    function getOrganizationId() {
      // Check if user has organizationId in custom claims
      let orgId = getUserClaims().get('organizationId', '');
      
      // If no organizationId in claims, check if it's a standalone user
      return orgId != '' ? orgId : 
        (request.auth.token.email == 'standalone.user@example.com' || 
         request.auth.token.email.matches('.*@example\\.com$')) ? 'standalone' : '';
    }
    
    // Check if user belongs to organization
    function belongsToOrganization(organizationId) {
      // Allow Super Admin to access any organization data
      return isOwnerOrAdmin() ||
      // Allow standalone users to access standalone organization
             (organizationId == 'standalone' && 
              (request.auth.token.email == 'standalone.user@example.com' || 
               request.auth.token.email.matches('.*@example\\.com$'))) ||
             (isAuthenticated() && getOrganizationId() == organizationId);
    }
    
    // Check if user has specific role
    function hasRole(role) {
      return isAuthenticated() && getUserClaims().get('role', '') == role;
    }
    
    // Check if user has any of the specified roles
    function hasAnyRole(roles) {
      return isAuthenticated() && getUserClaims().get('role', '') in roles;
    }
    
    // Check if user has organizational role
    function hasOrgRole(role) {
      return isAuthenticated() && getUserClaims().get('teamMemberRole', '') == role;
    }
    
    // Check if user has any organizational roles
    function hasAnyOrgRole(roles) {
      return isAuthenticated() && getUserClaims().get('teamMemberRole', '') in roles;
    }
    
    // Check if user is owner or admin
    function isOwnerOrAdmin() {
      return hasAnyRole(['OWNER', 'ADMIN', 'SUPERADMIN', 'SUPER_ADMIN']) || 
             hasAnyOrgRole(['owner', 'admin']) ||
             getUserClaims().get('isAdmin', false) ||
             getUserClaims().get('superAdmin', false) ||
             getUserClaims().get('canAccessAdminPanel', false);
    }
    
    // Check if user owns the document (userId field matches)
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    // Check if user can access project data
    function canAccessProject(projectId) {
      return isAuthenticated() && (
        // Allow Super Admin access
        isOwnerOrAdmin() ||
        // Check if user has project assignment
        projectId in getUserClaims().get('projectAssignments', {}) ||
        // Check if user belongs to organization
        belongsToOrganization(resource.data.organizationId) ||
        // Allow standalone users
        getOrganizationId() == 'standalone'
      );
    }
    
    // Check if user can modify project data
    function canModifyProject(projectId) {
      return isAuthenticated() && (
        // Allow Super Admin access
        isOwnerOrAdmin() ||
        // Check if user is project admin
        projectId in getUserClaims().get('projectAssignments', {}) &&
        getUserClaims().get('projectAssignments', {})[projectId].get('baseRole', '') in ['ADMIN', 'DO_ER'] ||
        // Check if user has organization admin role
        hasAnyOrgRole(['admin', 'owner']) ||
        // Allow standalone users
        getOrganizationId() == 'standalone'
      );
    }
    
    // Check if user has minimum hierarchy level
    function hasMinimumHierarchy(minLevel) {
      return isAuthenticated() && getUserClaims().get('effectiveHierarchy', 0) >= minLevel;
    }
    
    // Check if user has EDL Converter access
    function hasEDLConverterAccess() {
      return isAuthenticated() && getUserClaims().get('isEDLConverter', false);
    }
    
    // Check if user has Call Sheet access
    function hasCallSheetAccess() {
      return isAuthenticated() && getUserClaims().get('isCallSheetUser', false);
    }
    
    // Check if user is standalone user
    function isStandaloneUser() {
      return isAuthenticated() && getUserClaims().get('isStandaloneUser', false);
    }
    
    // ============================================================================
    // CORE COLLECTIONS
    // ============================================================================
    
    // Users - Core user data
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && request.auth.uid == userId;
      allow create: if isAuthenticated();
      allow update: if isAuthenticated() && (request.auth.uid == userId || isOwnerOrAdmin());
    }
    
    // Organizations - Organization data
    match /organizations/{orgId} {
      allow read: if isAuthenticated() && belongsToOrganization(orgId);
      allow write: if isAuthenticated() && belongsToOrganization(orgId) && isOwnerOrAdmin();
      allow create: if isAuthenticated() && isOwnerOrAdmin();
      allow update: if isAuthenticated() && belongsToOrganization(orgId) && isOwnerOrAdmin();
      
      // Dropbox Indexed Files - Files indexed from Dropbox
      match /dropboxIndexedFiles/{fileId} {
        allow read: if isAuthenticated() && (
          belongsToOrganization(orgId) ||
          isOwnerOrAdmin() ||
          (resource.data != null && resource.data.organizationId != null)
        );
        allow write: if isAuthenticated() && belongsToOrganization(orgId);
      }
      
      // Box Indexed Files - Files indexed from Box
      match /boxIndexedFiles/{fileId} {
        allow read: if isAuthenticated() && (
          belongsToOrganization(orgId) ||
          isOwnerOrAdmin() ||
          (resource.data != null && resource.data.organizationId != null)
        );
        allow write: if isAuthenticated() && belongsToOrganization(orgId);
      }
      
      // Indexed Files - Google Drive indexed files
      match /indexedFiles/{fileId} {
        allow read: if isAuthenticated() && (
          belongsToOrganization(orgId) ||
          isOwnerOrAdmin() ||
          (resource.data != null && resource.data.organizationId != null)
        );
        allow write: if isAuthenticated() && belongsToOrganization(orgId);
      }
      
      // Call Sheet Projects - Projects from Call Sheet app
      match /callsheet-projects/{projectId} {
        allow read: if isAuthenticated() && (
          belongsToOrganization(orgId) ||
          isOwnerOrAdmin() ||
          (resource.data != null && resource.data.organizationId != null)
        );
        allow write: if isAuthenticated() && belongsToOrganization(orgId);
      }
      
      // Slack Connections - Slack workspace integrations (subcollection)
      match /slackConnections/{connectionId} {
        allow read: if isAuthenticated() && (
          // Allow if user has orgId claim and it matches parent org
          (getOrganizationId() != '' && getOrganizationId() == orgId) ||
          // Allow admins
          isOwnerOrAdmin() ||
          // Allow any authenticated user to read (parent orgId in path ensures scoping)
          isAuthenticated()
        );
        allow write: if isAuthenticated() && (
          (getOrganizationId() != '' && getOrganizationId() == orgId) ||
          isOwnerOrAdmin()
        );
      }
      
      // Slack Channels - Slack channel mappings (subcollection)
      match /slackChannels/{channelId} {
        allow read: if isAuthenticated() && (
          // Allow if user has orgId claim and it matches parent org
          (getOrganizationId() != '' && getOrganizationId() == orgId) ||
          // Allow admins
          isOwnerOrAdmin() ||
          // Allow any authenticated user to read (parent orgId in path ensures scoping)
          isAuthenticated()
        );
        allow write: if isAuthenticated() && (
          (getOrganizationId() != '' && getOrganizationId() == orgId) ||
          isOwnerOrAdmin()
        );
      }
      
      // Integration Configs - Integration configuration (subcollection)
      match /integrationConfigs/{configId} {
        allow read: if isAuthenticated() && (
          // Allow if user has orgId claim and it matches parent org
          (getOrganizationId() != '' && getOrganizationId() == orgId) ||
          // Allow admins
          isOwnerOrAdmin() ||
          // Allow any authenticated user to read (parent orgId in path ensures scoping)
          isAuthenticated()
        );
        allow write: if isAuthenticated() && (
          (getOrganizationId() != '' && getOrganizationId() == orgId) ||
          isOwnerOrAdmin()
        );
      }
    }
    
    // Team Members - Team member data
    match /teamMembers/{memberId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow write: if isAuthenticated() && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin();
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId) && isOwnerOrAdmin();
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin();
    }
    
    // Project Team Members - Project-specific team member assignments
    match /projectTeamMembers/{assignmentId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        request.auth.uid == resource.data.teamMemberId ||
        canAccessProject(resource.data.projectId)
      );
      allow write: if isAuthenticated() && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin();
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId) && isOwnerOrAdmin();
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin();
    }
    
    // Projects - Project data
    match /projects/{projectId} {
      allow read: if canAccessProject(projectId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if canModifyProject(projectId);
      allow delete: if isAuthenticated() && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin();
    }
    
    // Sessions - Production sessions
    match /sessions/{sessionId} {
      allow read: if belongsToOrganization(resource.data.organizationId);
      allow create: if belongsToOrganization(request.resource.data.organizationId) 
                    && request.resource.data.organizationId == getOrganizationId()
                    && request.resource.data.createdBy == request.auth.uid;
      allow update: if belongsToOrganization(resource.data.organizationId) 
                    && request.resource.data.organizationId == resource.data.organizationId;
      allow delete: if belongsToOrganization(resource.data.organizationId);
    }
    
    // Timecards
    match /timecards/{timecardId} {
      allow read: if isOwner(resource.data.userId) || 
                     canAccessProject(resource.data.projectId);
      allow create: if canAccessProject(request.resource.data.projectId);
      allow update: if isOwner(resource.data.userId) || 
                       canModifyProject(resource.data.projectId);
    }
    
    // Inventory Items - Organization-wide access with optional project filtering
    match /inventoryItems/{itemId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        (resource.data.projectId != null && canAccessProject(resource.data.projectId))
      );
      allow write: if isAuthenticated() && (
        (belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin()) ||
        (resource.data.projectId != null && canModifyProject(resource.data.projectId))
      );
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && (
        (belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin()) ||
        (resource.data.projectId != null && canModifyProject(resource.data.projectId))
      );
      allow delete: if isAuthenticated() && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin();
    }
    
    // Reports
    match /reports/{reportId} {
      allow read: if canAccessProject(resource.data.projectId);
      allow create: if canAccessProject(request.resource.data.projectId);
      allow update: if isOwner(resource.data.userId) || 
                       canModifyProject(resource.data.projectId);
    }
    
    // Notifications
    match /notifications/{notificationId} {
      allow read: if isOwner(resource.data.userId);
      allow create: if true; // System can create notifications
      allow update: if isOwner(resource.data.userId);
    }
    
    // Message Sessions - Real-time messaging sessions
    match /messageSessions/{sessionId} {
      allow read: if isAuthenticated() && (
        isOwnerOrAdmin() ||
        (resource != null && 
         belongsToOrganization(resource.data.organizationId) &&
         request.auth.uid in resource.data.participantIds)
      );
      
      allow write: if isAuthenticated() && (
        isOwnerOrAdmin() ||
        belongsToOrganization(request.resource.data.organizationId)
      );
    }
    
    // ============================================================================
    // LICENSING WEBSITE COLLECTIONS
    // ============================================================================
    
    // Licenses - Enhanced license validation with claims
    match /licenses/{licenseId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        (isAuthenticated() && resource.data.userId == request.auth.uid) ||
        isAuthenticated()
      );
      allow create: if isAuthenticated() && (
        belongsToOrganization(request.resource.data.organizationId) && 
        hasAnyOrgRole(['owner', 'admin']) ||
        (isAuthenticated() && request.resource.data.userId == request.auth.uid)
      );
      allow update: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) && 
        hasAnyOrgRole(['owner', 'admin']) ||
        resource.data.userId == request.auth.uid
      );
      allow delete: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) && 
        hasAnyOrgRole(['owner', 'admin'])
      );
    }
    
    // Subscriptions - Admin access for dashboard stats
    match /subscriptions/{subscriptionId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        resource.data.userId == request.auth.uid ||
        isOwnerOrAdmin()
      );
      allow create: if isAuthenticated() && (
        belongsToOrganization(request.resource.data.organizationId) && 
        hasAnyOrgRole(['owner', 'admin']) ||
        request.resource.data.userId == request.auth.uid
      );
      allow update: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) && 
        hasAnyOrgRole(['owner', 'admin']) ||
        resource.data.userId == request.auth.uid
      );
      allow delete: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) && 
        hasAnyOrgRole(['owner', 'admin'])
      );
    }
    
    // Standalone Licenses - Enhanced license validation
    match /standaloneLicenses/{licenseId} {
      allow read: if isAuthenticated() && (
        isAuthenticated() ||
        resource.data.userId == request.auth.uid ||
        hasAnyRole(['OWNER', 'ADMIN'])
      );
      allow create: if isAuthenticated() && (
        isAuthenticated() && 
        request.resource.data.userId == request.auth.uid
      );
      allow update: if isAuthenticated() && (
        resource.data.userId == request.auth.uid ||
        hasAnyRole(['OWNER', 'ADMIN'])
      );
      allow delete: if isAuthenticated() && (
        resource.data.userId == request.auth.uid ||
        hasAnyRole(['OWNER', 'ADMIN'])
      );
    }
    
    // ============================================================================
    // CALL SHEET APP COLLECTIONS
    // ============================================================================
    
    // Call sheets collection
    match /callsheetCallSheets/{callSheetId} {
      allow read, write: if isAuthenticated() && hasCallSheetAccess();
    }
    
    // Personnel collection
    match /callsheetPersonnel/{personnelId} {
      allow read, write: if isAuthenticated() && hasCallSheetAccess();
    }
    
    // Templates collection
    match /callsheetTemplates/{templateId} {
      allow read, write: if isAuthenticated() && hasCallSheetAccess();
    }
    
    // Published call sheets collection
    match /callsheetPublishedCallSheets/{publishId} {
      allow read, write: if isAuthenticated() && hasCallSheetAccess();
    }
    
    // Call sheet links collection
    match /callsheetLinks/{linkId} {
      allow read: if true; // Public read access for published links
      allow write: if isAuthenticated() && hasCallSheetAccess();
    }
    
    // Daily call sheet records collection - user-specific access
    match /callsheetDailyRecords/{recordId} {
      allow read, write: if isAuthenticated() && hasCallSheetAccess() 
        && request.auth.uid == resource.data.userId;
      allow create: if isAuthenticated() && hasCallSheetAccess() 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // ============================================================================
    // EDL CONVERTER COLLECTIONS
    // ============================================================================
    
    // EDL Files - EDL file data for standalone converter
    match /edlFiles/{fileId} {
      allow read: if isAuthenticated() && hasEDLConverterAccess();
      allow create: if isAuthenticated() && hasEDLConverterAccess();
      allow update: if isAuthenticated() && hasEDLConverterAccess();
      allow delete: if isAuthenticated() && hasEDLConverterAccess();
    }
    
    // EDL File Metadata - Metadata for chunked files
    match /edlFileMetadata/{document} {
      allow read: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        resource.data.userId == request.auth.uid
      );
      allow create: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(request.resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        request.resource.data.userId == request.auth.uid
      );
      allow update: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        resource.data.userId == request.auth.uid
      );
      allow delete: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        resource.data.userId == request.auth.uid
      );
    }
    
    // EDL File Chunks - Chunked data for large files
    match /edlFileChunks/{document} {
      allow read: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        resource.data.userId == request.auth.uid
      );
      allow create: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(request.resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        request.resource.data.userId == request.auth.uid
      );
      allow update: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        resource.data.userId == request.auth.uid
      );
      allow delete: if isAuthenticated() && hasEDLConverterAccess() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone' ||
        resource.data.userId == request.auth.uid
      );
    }
    
    // EDL Projects - EDL project management
    // Allow Parser Brain users to read EDL projects (they need access for ecosystem graph)
    match /edlProjects/{projectId} {
      allow read: if isAuthenticated() && (
        // EDL Converter users with access
        (hasEDLConverterAccess() && resource.data != null && (
          belongsToOrganization(resource.data.organizationId) ||
          getOrganizationId() == 'standalone' ||
          resource.data.userId == request.auth.uid
        )) ||
        // Parser Brain users - allow read for ecosystem graph (check organization match)
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
      allow create: if isAuthenticated() && (
        (hasEDLConverterAccess() && (
          belongsToOrganization(request.resource.data.organizationId) ||
          getOrganizationId() == 'standalone' ||
          request.resource.data.userId == request.auth.uid
        )) ||
        (belongsToOrganization(request.resource.data.organizationId) && isOwnerOrAdmin())
      );
      allow update: if isAuthenticated() && (
        (hasEDLConverterAccess() && resource.data != null && (
          belongsToOrganization(resource.data.organizationId) ||
          getOrganizationId() == 'standalone' ||
          resource.data.userId == request.auth.uid
        )) ||
        (resource.data != null && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin())
      );
      allow delete: if isAuthenticated() && (
        (hasEDLConverterAccess() && resource.data != null && (
          belongsToOrganization(resource.data.organizationId) ||
          getOrganizationId() == 'standalone' ||
          resource.data.userId == request.auth.uid
        )) ||
        (resource.data != null && belongsToOrganization(resource.data.organizationId) && isOwnerOrAdmin())
      );
    }
    
    // ============================================================================
    // PARSER BRAIN COLLECTIONS
    // ============================================================================
    
    // Parsing patterns
    match /parsing-patterns/{patternId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && hasMinimumHierarchy(50);
    }
    
    // Pattern statistics
    match /pattern-statistics/{statId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && hasMinimumHierarchy(50);
    }
    
    // Pattern submissions
    match /pattern-submissions/{submissionId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // ============================================================================
    // SYSTEM COLLECTIONS
    // ============================================================================
    
    // System Configuration - Global system settings and collection metadata
    match /_system/{docId} {
      allow read: if isAuthenticated();
      // Allow all authenticated users to write system config (needed for ProjectDatasetFilterService)
      allow write: if isAuthenticated();
    }
    
    // Health Monitoring - System health and status
    match /_health/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && (
        hasAnyRole(['OWNER', 'ADMIN']) || 
        hasAnyOrgRole(['owner', 'admin'])
      );
    }
    
    // ============================================================================
    // GENERIC COLLECTIONS
    // ============================================================================
    
    // Project Data - Project-specific data container
    match /projectData/{dataId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone'
      );
      allow create: if isAuthenticated() && (
        belongsToOrganization(request.resource.data.organizationId) ||
        getOrganizationId() == 'standalone'
      );
      allow update: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone'
      );
      allow delete: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        getOrganizationId() == 'standalone'
      );
    }

    // Folders - General folder structure (used by FolderPermissionManager)
    match /folders/{folderId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }

    // Map Layouts
    match /mapLayouts/{layoutId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow project access
        canAccessProject(resource.data.projectId) ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin() ||
        canModifyProject(resource.data.projectId)
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin() ||
        canModifyProject(resource.data.projectId)
      );
    }

    // Media Files
    match /mediaFiles/{fileId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        canAccessProject(resource.data.projectId)
      );
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        canModifyProject(resource.data.projectId)
      );
      allow delete: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        canModifyProject(resource.data.projectId)
      );
    }

    // Network IP Assignments
    match /networkIPAssignments/{assignmentId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        canAccessProject(resource.data.projectId)
      );
      allow write: if isAuthenticated() && isOwnerOrAdmin();
    }

    // Networks
    match /networks/{networkId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow write: if isAuthenticated() && isOwnerOrAdmin();
    }

    // Network IP Ranges
    match /networkIPRanges/{rangeId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow write: if isAuthenticated() && isOwnerOrAdmin();
    }

    // Schemas - Data structure definitions
    match /schemas/{schemaId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && isOwnerOrAdmin();
      allow create: if isAuthenticated();
    }

    // Slack Connections - Slack workspace integrations (root collection)
    match /slackConnections/{connectionId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }

    // Slack Channels - Slack channel mappings (root collection)
    match /slackChannels/{channelId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
    }

    // Contacts - Contact information
    // More permissive: allow authenticated users to read (query filter handles org matching)
    match /contacts/{contactId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow standalone users
        getOrganizationId() == 'standalone' ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
    }

    // ============================================================================
    // CLIP SHOW PRO COLLECTIONS
    // ============================================================================
    
    // Clip Show Projects - Project metadata for Clip Show Pro
    // More permissive: allow authenticated users to read (query filter handles org matching)
    match /clipShowProjects/{projectId} {
      allow read: if isAuthenticated() && (
        // If user has organizationId claim, check it matches document's orgId
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow standalone users
        getOrganizationId() == 'standalone' ||
        // Allow authenticated users to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }
    
    // Clip Show Folders - Folder structure for Clip Show Pro projects
    // More permissive: allow authenticated users to read (query filter handles org matching)
    match /clipShowFolders/{folderId} {
      allow read: if isAuthenticated() && (
        // If user has organizationId claim, check it matches document's orgId
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow standalone users
        getOrganizationId() == 'standalone' ||
        // Allow authenticated users to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }

    // Notes - User notes and annotations
    match /notes/{noteId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        isOwner(resource.data.userId)
      );
      allow write: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        isOwner(resource.data.userId)
      );
      allow create: if isAuthenticated();
    }
    
    // ============================================================================
    // MISSING ROOT COLLECTIONS (Added for EcosystemGraphService)
    // ============================================================================

    // Budgets - Allow authenticated users to read budgets from their organization
    match /budgets/{budgetId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow create: if isAuthenticated() && (
        belongsToOrganization(request.resource.data.organizationId) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
    }

    // Post Production Tasks
    match /postProductionTasks/{taskId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        (resource.data != null && canAccessProject(resource.data.projectId)) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow create: if isAuthenticated() && (
        belongsToOrganization(request.resource.data.organizationId) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        (resource.data != null && canModifyProject(resource.data.projectId)) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && belongsToOrganization(resource.data.organizationId)) ||
        isOwnerOrAdmin() ||
        getOrganizationId() == 'standalone'
      );
    }

    // Invoices
    match /invoices/{invoiceId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Payments
    match /payments/{paymentId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Cue Sheets
    match /cueSheets/{cueSheetId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }
    
    // Workflow Instances
    match /workflowInstances/{workflowId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Conversations
    match /conversations/{conversationId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Clip Show Pitches (Root)
    match /clipShowPitches/{pitchId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Clip Show Stories (Root)
    match /clipShowStories/{storyId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Call Sheets (Root - for EcosystemGraphService)
    match /callSheets/{callSheetId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        hasCallSheetAccess()
      );
      allow create: if isAuthenticated() && (
        belongsToOrganization(request.resource.data.organizationId) ||
        hasCallSheetAccess()
      );
      allow update: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        hasCallSheetAccess()
      );
    }

    // ============================================================================
    // TIMECARD COLLECTIONS
    // ============================================================================
    
    // Timecard Configurations
    match /timecardConfigurations/{configId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }
    
    // Timecard Assignments (using underscore naming)
    match /timecard_assignments/{assignmentId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }
    
    // Timecard Assignments (using camelCase naming - alternative)
    match /timecardAssignments/{assignmentId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }
    
    // Timecard Templates
    match /timecardTemplates/{templateId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }
    
    // Direct Reports
    match /directReports/{reportId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }

    // ============================================================================
    // GLOBAL COLLECTIONS (Not organization-specific)
    // ============================================================================
    
    // Page Info - Global page information (not organization-specific)
    match /pageInfo/{pageId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && isOwnerOrAdmin();
    }
    
    // Data Sync Events - Data synchronization events
    match /dataSyncEvents/{eventId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
    }
    
    // Inventory Schemas - Inventory schema definitions
    match /inventorySchemas/{schemaId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
    }

    // ============================================================================
    // FIREBASE STORAGE COLLECTIONS
    // ============================================================================
    
    // Firebase Storage Folders - Folder structure for Firebase Storage
    match /firebaseStorageFolders/{folderId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
    }
    
    // Firebase Storage Files - Files stored in Firebase Storage
    match /firebaseStorageFiles/{fileId} {
      allow read: if isAuthenticated() && (
        // Allow if user has orgId claim and it matches
        (resource.data != null && resource.data.organizationId != null && 
         getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId) ||
        // Allow admins
        isOwnerOrAdmin() ||
        // Allow any authenticated user to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow write: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId)) ||
        isOwnerOrAdmin()
      );
    }

    // ============================================================================
    // FILE COLLECTIONS
    // ============================================================================
    
    // Clip Show Indexed Files - Local indexed files from desktop app
    match /clipShowIndexedFiles/{fileId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        // Allow authenticated users to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }
    
    // Files - Firebase Storage files
    match /files/{fileId} {
      allow read: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin() ||
        // Allow authenticated users to read documents with organizationId
        // Query filter ensures they only see their org's data
        (resource.data != null && resource.data.organizationId != null)
      );
      allow create: if isAuthenticated() && (
        (request.resource.data.organizationId != null && 
         (belongsToOrganization(request.resource.data.organizationId) || 
          (getOrganizationId() != '' && getOrganizationId() == request.resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow update: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
      allow delete: if isAuthenticated() && (
        (resource.data != null && resource.data.organizationId != null && 
         (belongsToOrganization(resource.data.organizationId) ||
          (getOrganizationId() != '' && getOrganizationId() == resource.data.organizationId))) ||
        isOwnerOrAdmin()
      );
    }

    // ============================================================================
    // UNIVERSAL SEARCH / COLLECTION GROUP QUERIES
    // ============================================================================
    
    // Team Members (Global Query)
    match /{path=**}/teamMembers/{memberId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // Timecards (Global Query)
    match /{path=**}/timecards/{timecardId} {
      allow read: if isAuthenticated() && (
        isOwner(resource.data.userId) || 
        canAccessProject(resource.data.projectId) ||
        belongsToOrganization(resource.data.organizationId)
      );
    }
    
    // Call Sheets (Global Query - covering both potential names)
    match /{path=**}/callSheets/{callSheetId} {
      allow read: if isAuthenticated() && hasCallSheetAccess();
    }
     match /{path=**}/callsheetCallSheets/{callSheetId} {
      allow read: if isAuthenticated() && hasCallSheetAccess();
    }
    
    // Clip Pitches (Global Query)
    match /{path=**}/clipPitches/{pitchId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }
    
    // Production Stories (Global Query)
    match /{path=**}/productionStories/{storyId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }
    
    // Cue Sheets (Global Query)
    match /{path=**}/cueSheets/{cueSheetId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }
    
    // Budget Values (Global Query)
    match /{path=**}/budgetValues/{budgetId} {
      allow read: if isAuthenticated() && (
        belongsToOrganization(resource.data.organizationId) ||
        canAccessProject(resource.data.projectId)
      );
    }
    
    // Project Sessions (Global Query - covering both potential names)
    match /{path=**}/projectSessions/{sessionId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }
    match /{path=**}/sessions/{sessionId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }
    
    // License Agreements (Global Query)
    match /{path=**}/licenseAgreements/{licenseId} {
      allow read: if isAuthenticated() && belongsToOrganization(resource.data.organizationId);
    }

    // ============================================================================
    // WORKFLOW COLLECTIONS
    // ============================================================================
    
    // Workflow Steps
    match /workflowSteps/{stepId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow write: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(request.resource.data.organizationId));
    }
    
    // Workflow Steps (Global Query)
    match /{path=**}/workflowSteps/{stepId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }
    
    // User Workflows
    match /workflows/{workflowId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId) || isOwner(resource.data.userId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId));
    }
    
    // Workflow Assignments
    match /workflowAssignments/{assignmentId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow write: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(request.resource.data.organizationId));
    }
    
    // Workflow Assignments (Global Query)
    match /{path=**}/workflowAssignments/{assignmentId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }
    
    // Network Delivery Bibles
    match /networkDeliveryBibles/{bibleId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow write: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(request.resource.data.organizationId));
    }
    
    // Network Delivery Bibles (Global Query)
    match /{path=**}/networkDeliveryBibles/{bibleId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // ============================================================================
    // AUTO-GENERATED RULES FOR MISSING COLLECTIONS
    // ============================================================================

    // _collections_metadata Collection
    match /_collections_metadata/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // _collections_metadata (Global Query)
    match /{path=**}/_collections_metadata/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // _temp Collection
    match /_temp/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // _temp (Global Query)
    match /{path=**}/_temp/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // _test Collection
    match /_test/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // _test (Global Query)
    match /{path=**}/_test/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // activityLogs Collection
    match /activityLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // activityLogs (Global Query)
    match /{path=**}/activityLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // agents Collection
    match /agents/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // agents (Global Query)
    match /{path=**}/agents/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // aiAgents Collection
    match /aiAgents/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // aiAgents (Global Query)
    match /{path=**}/aiAgents/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // apiKeys Collection
    match /apiKeys/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // apiKeys (Global Query)
    match /{path=**}/apiKeys/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // appRoleDefinitions Collection
    match /appRoleDefinitions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // appRoleDefinitions (Global Query)
    match /{path=**}/appRoleDefinitions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // assets Collection
    match /assets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // assets (Global Query)
    match /{path=**}/assets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // audit_logs Collection
    match /audit_logs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // audit_logs (Global Query)
    match /{path=**}/audit_logs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // automationExecutions Collection
    match /automationExecutions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // automationExecutions (Global Query)
    match /{path=**}/automationExecutions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpDailyStatus Collection
    match /bmpDailyStatus/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpDailyStatus (Global Query)
    match /{path=**}/bmpDailyStatus/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpPayscales Collection
    match /bmpPayscales/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpPayscales (Global Query)
    match /{path=**}/bmpPayscales/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpProjects Collection
    match /bmpProjects/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpProjects (Global Query)
    match /{path=**}/bmpProjects/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpWorkflowInstances Collection
    match /bmpWorkflowInstances/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpWorkflowInstances (Global Query)
    match /{path=**}/bmpWorkflowInstances/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpWorkflows Collection
    match /bmpWorkflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // bmpWorkflows (Global Query)
    match /{path=**}/bmpWorkflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainChatMessages Collection
    match /brainChatMessages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainChatMessages (Global Query)
    match /{path=**}/brainChatMessages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainChatSessions Collection
    match /brainChatSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainChatSessions (Global Query)
    match /{path=**}/brainChatSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainConversationSessions Collection
    match /brainConversationSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainConversationSessions (Global Query)
    match /{path=**}/brainConversationSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainMemory Collection
    match /brainMemory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainMemory (Global Query)
    match /{path=**}/brainMemory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainSessions Collection
    match /brainSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // brainSessions (Global Query)
    match /{path=**}/brainSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // callSheetAccess Collection
    match /callSheetAccess/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // callSheetAccess (Global Query)
    match /{path=**}/callSheetAccess/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // callsheets Collection
    match /callsheets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // callsheets (Global Query)
    match /{path=**}/callsheets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // chats Collection
    match /chats/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // chats (Global Query)
    match /{path=**}/chats/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // clients Collection
    match /clients/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // clients (Global Query)
    match /{path=**}/clients/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // clipShowContacts Collection
    match /clipShowContacts/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // clipShowContacts (Global Query)
    match /{path=**}/clipShowContacts/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // collaborationInvitations Collection
    match /collaborationInvitations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // collaborationInvitations (Global Query)
    match /{path=**}/collaborationInvitations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // commandCenterLayouts Collection
    match /commandCenterLayouts/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // commandCenterLayouts (Global Query)
    match /{path=**}/commandCenterLayouts/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // contactGroups Collection
    match /contactGroups/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // contactGroups (Global Query)
    match /{path=**}/contactGroups/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // conversationPatterns Collection
    match /conversationPatterns/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // conversationPatterns (Global Query)
    match /{path=**}/conversationPatterns/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // customRoles Collection
    match /customRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // customRoles (Global Query)
    match /{path=**}/customRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // dailyCallSheetRecords Collection
    match /dailyCallSheetRecords/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // dailyCallSheetRecords (Global Query)
    match /{path=**}/dailyCallSheetRecords/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // dailyCallSheets Collection
    match /dailyCallSheets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // dailyCallSheets (Global Query)
    match /{path=**}/dailyCallSheets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // datasetAssignments Collection
    match /datasetAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // datasetAssignments (Global Query)
    match /{path=**}/datasetAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // datasets Collection
    match /datasets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // datasets (Global Query)
    match /{path=**}/datasets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // deliverableProcessingResults Collection
    match /deliverableProcessingResults/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // deliverableProcessingResults (Global Query)
    match /{path=**}/deliverableProcessingResults/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // deliverables Collection
    match /deliverables/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // deliverables (Global Query)
    match /{path=**}/deliverables/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // demoSessions Collection
    match /demoSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // demoSessions (Global Query)
    match /{path=**}/demoSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // domainKnowledge Collection
    match /domainKnowledge/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // domainKnowledge (Global Query)
    match /{path=**}/domainKnowledge/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // edlStandaloneUsers Collection
    match /edlStandaloneUsers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // edlStandaloneUsers (Global Query)
    match /{path=**}/edlStandaloneUsers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // edlWorkspaces Collection
    match /edlWorkspaces/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // edlWorkspaces (Global Query)
    match /{path=**}/edlWorkspaces/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // edl_data Collection
    match /edl_data/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // edl_data (Global Query)
    match /{path=**}/edl_data/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // enhancedDeliverables Collection
    match /enhancedDeliverables/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // enhancedDeliverables (Global Query)
    match /{path=**}/enhancedDeliverables/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // entityLocations Collection
    match /entityLocations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // entityLocations (Global Query)
    match /{path=**}/entityLocations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // health Collection
    match /health/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // health (Global Query)
    match /{path=**}/health/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // health-check Collection
    match /health-check/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // health-check (Global Query)
    match /{path=**}/health-check/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // integrations Collection
    match /integrations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // integrations (Global Query)
    match /{path=**}/integrations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // inventory Collection
    match /inventory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // inventory (Global Query)
    match /{path=**}/inventory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // inventoryAssignmentHistory Collection
    match /inventoryAssignmentHistory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // inventoryAssignmentHistory (Global Query)
    match /{path=**}/inventoryAssignmentHistory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // inventoryHistory Collection
    match /inventoryHistory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // inventoryHistory (Global Query)
    match /{path=**}/inventoryHistory/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // invitations Collection
    match /invitations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // invitations (Global Query)
    match /{path=**}/invitations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // invoiceItems Collection
    match /invoiceItems/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // invoiceItems (Global Query)
    match /{path=**}/invoiceItems/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // licenseValidations Collection
    match /licenseValidations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // licenseValidations (Global Query)
    match /{path=**}/licenseValidations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // lifecycleRules Collection
    match /lifecycleRules/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // lifecycleRules (Global Query)
    match /{path=**}/lifecycleRules/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // mediaIndexes Collection
    match /mediaIndexes/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // mediaIndexes (Global Query)
    match /{path=**}/mediaIndexes/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // memorySlots Collection
    match /memorySlots/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // memorySlots (Global Query)
    match /{path=**}/memorySlots/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // messages Collection
    match /messages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // messages (Global Query)
    match /{path=**}/messages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // migrationLogs Collection
    match /migrationLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // migrationLogs (Global Query)
    match /{path=**}/migrationLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // migrationResults Collection
    match /migrationResults/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // migrationResults (Global Query)
    match /{path=**}/migrationResults/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // migrations Collection
    match /migrations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // migrations (Global Query)
    match /{path=**}/migrations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // monitoringReports Collection
    match /monitoringReports/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // monitoringReports (Global Query)
    match /{path=**}/monitoringReports/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // networkIP Collection
    match /networkIP/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // networkIP (Global Query)
    match /{path=**}/networkIP/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // nonexistent_collection Collection
    match /nonexistent_collection/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // nonexistent_collection (Global Query)
    match /{path=**}/nonexistent_collection/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // notificationSettings Collection
    match /notificationSettings/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // notificationSettings (Global Query)
    match /{path=**}/notificationSettings/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // orgMembers Collection
    match /orgMembers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // orgMembers (Global Query)
    match /{path=**}/orgMembers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // org_members Collection
    match /org_members/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // org_members (Global Query)
    match /{path=**}/org_members/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // parsing-admin-users Collection
    match /parsing-admin-users/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // parsing-admin-users (Global Query)
    match /{path=**}/parsing-admin-users/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmAnalytics Collection
    match /pbmAnalytics/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmAnalytics (Global Query)
    match /{path=**}/pbmAnalytics/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmDailyStatus Collection
    match /pbmDailyStatus/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmDailyStatus (Global Query)
    match /{path=**}/pbmDailyStatus/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmPayscales Collection
    match /pbmPayscales/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmPayscales (Global Query)
    match /{path=**}/pbmPayscales/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmProjects Collection
    match /pbmProjects/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmProjects (Global Query)
    match /{path=**}/pbmProjects/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmSchedules Collection
    match /pbmSchedules/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // pbmSchedules (Global Query)
    match /{path=**}/pbmSchedules/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // people Collection
    match /people/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // people (Global Query)
    match /{path=**}/people/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // portfolios Collection
    match /portfolios/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // portfolios (Global Query)
    match /{path=**}/portfolios/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionCrewMembers Collection
    match /productionCrewMembers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionCrewMembers (Global Query)
    match /{path=**}/productionCrewMembers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionDepartments Collection
    match /productionDepartments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionDepartments (Global Query)
    match /{path=**}/productionDepartments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionRoles Collection
    match /productionRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionRoles (Global Query)
    match /{path=**}/productionRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionSessions Collection
    match /productionSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionSessions (Global Query)
    match /{path=**}/productionSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionStages Collection
    match /productionStages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionStages (Global Query)
    match /{path=**}/productionStages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionTaskAssignees Collection
    match /productionTaskAssignees/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionTaskAssignees (Global Query)
    match /{path=**}/productionTaskAssignees/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionTasks Collection
    match /productionTasks/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // productionTasks (Global Query)
    match /{path=**}/productionTasks/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectActivities Collection
    match /projectActivities/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectActivities (Global Query)
    match /{path=**}/projectActivities/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectAssignments Collection
    match /projectAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectAssignments (Global Query)
    match /{path=**}/projectAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectDatasets Collection
    match /projectDatasets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectDatasets (Global Query)
    match /{path=**}/projectDatasets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectFolderAssignments Collection
    match /projectFolderAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectFolderAssignments (Global Query)
    match /{path=**}/projectFolderAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectRoleAssignments Collection
    match /projectRoleAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectRoleAssignments (Global Query)
    match /{path=**}/projectRoleAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectRoles Collection
    match /projectRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // projectRoles (Global Query)
    match /{path=**}/projectRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // project_datasets Collection
    match /project_datasets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // project_datasets (Global Query)
    match /{path=**}/project_datasets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // project_participants Collection
    match /project_participants/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // project_participants (Global Query)
    match /{path=**}/project_participants/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // project_team_members Collection
    match /project_team_members/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // project_team_members (Global Query)
    match /{path=**}/project_team_members/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // publishedCallSheets Collection
    match /publishedCallSheets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // publishedCallSheets (Global Query)
    match /{path=**}/publishedCallSheets/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcChecklistItems Collection
    match /qcChecklistItems/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcChecklistItems (Global Query)
    match /{path=**}/qcChecklistItems/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcReports Collection
    match /qcReports/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcReports (Global Query)
    match /{path=**}/qcReports/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcSessions Collection
    match /qcSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcSessions (Global Query)
    match /{path=**}/qcSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcStatuses Collection
    match /qcStatuses/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // qcStatuses (Global Query)
    match /{path=**}/qcStatuses/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // realTimePresence Collection
    match /realTimePresence/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // realTimePresence (Global Query)
    match /{path=**}/realTimePresence/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewApprovals Collection
    match /reviewApprovals/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewApprovals (Global Query)
    match /{path=**}/reviewApprovals/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewAssignments Collection
    match /reviewAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewAssignments (Global Query)
    match /{path=**}/reviewAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewNotes Collection
    match /reviewNotes/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewNotes (Global Query)
    match /{path=**}/reviewNotes/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewSessions Collection
    match /reviewSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // reviewSessions (Global Query)
    match /{path=**}/reviewSessions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // rolePermissionCalculations Collection
    match /rolePermissionCalculations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // rolePermissionCalculations (Global Query)
    match /{path=**}/rolePermissionCalculations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // roleTemplates Collection
    match /roleTemplates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // roleTemplates (Global Query)
    match /{path=**}/roleTemplates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // roles Collection
    match /roles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // roles (Global Query)
    match /{path=**}/roles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // savedContainers Collection
    match /savedContainers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // savedContainers (Global Query)
    match /{path=**}/savedContainers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // scheduledActions Collection
    match /scheduledActions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // scheduledActions (Global Query)
    match /{path=**}/scheduledActions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // schedulerEvents Collection
    match /schedulerEvents/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // schedulerEvents (Global Query)
    match /{path=**}/schedulerEvents/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // schedulerTasks Collection
    match /schedulerTasks/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // schedulerTasks (Global Query)
    match /{path=**}/schedulerTasks/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // schemaFields Collection
    match /schemaFields/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // schemaFields (Global Query)
    match /{path=**}/schemaFields/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // securityAlerts Collection
    match /securityAlerts/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // securityAlerts (Global Query)
    match /{path=**}/securityAlerts/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // securityAuditLogs Collection
    match /securityAuditLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // securityAuditLogs (Global Query)
    match /{path=**}/securityAuditLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // servers Collection
    match /servers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // servers (Global Query)
    match /{path=**}/servers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionArchives Collection
    match /sessionArchives/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionArchives (Global Query)
    match /{path=**}/sessionArchives/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionAssignments Collection
    match /sessionAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionAssignments (Global Query)
    match /{path=**}/sessionAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionAutomations Collection
    match /sessionAutomations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionAutomations (Global Query)
    match /{path=**}/sessionAutomations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionFileTags Collection
    match /sessionFileTags/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionFileTags (Global Query)
    match /{path=**}/sessionFileTags/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionFiles Collection
    match /sessionFiles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionFiles (Global Query)
    match /{path=**}/sessionFiles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionReviews Collection
    match /sessionReviews/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionReviews (Global Query)
    match /{path=**}/sessionReviews/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionRoles Collection
    match /sessionRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionRoles (Global Query)
    match /{path=**}/sessionRoles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionTags Collection
    match /sessionTags/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionTags (Global Query)
    match /{path=**}/sessionTags/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionWorkflows Collection
    match /sessionWorkflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // sessionWorkflows (Global Query)
    match /{path=**}/sessionWorkflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // session_timecard_links Collection
    match /session_timecard_links/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // session_timecard_links (Global Query)
    match /{path=**}/session_timecard_links/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // stages Collection
    match /stages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // stages (Global Query)
    match /{path=**}/stages/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // standaloneUsers Collection
    match /standaloneUsers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // standaloneUsers (Global Query)
    match /{path=**}/standaloneUsers/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // steps Collection
    match /steps/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // steps (Global Query)
    match /{path=**}/steps/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // systemLogs Collection
    match /systemLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // systemLogs (Global Query)
    match /{path=**}/systemLogs/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // temp Collection
    match /temp/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // temp (Global Query)
    match /{path=**}/temp/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // templateUsage Collection
    match /templateUsage/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // templateUsage (Global Query)
    match /{path=**}/templateUsage/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // test Collection
    match /test/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // test (Global Query)
    match /{path=**}/test/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // testCollection Collection
    match /testCollection/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // testCollection (Global Query)
    match /{path=**}/testCollection/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_approval_flows Collection
    match /timecard_approval_flows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_approval_flows (Global Query)
    match /{path=**}/timecard_approval_flows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_approvals Collection
    match /timecard_approvals/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_approvals (Global Query)
    match /{path=**}/timecard_approvals/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_configurations Collection
    match /timecard_configurations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_configurations (Global Query)
    match /{path=**}/timecard_configurations/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_entries Collection
    match /timecard_entries/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_entries (Global Query)
    match /{path=**}/timecard_entries/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_template_assignments Collection
    match /timecard_template_assignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_template_assignments (Global Query)
    match /{path=**}/timecard_template_assignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_templates Collection
    match /timecard_templates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // timecard_templates (Global Query)
    match /{path=**}/timecard_templates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // transactions Collection
    match /transactions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // transactions (Global Query)
    match /{path=**}/transactions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedSessionAssignments Collection
    match /unifiedSessionAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedSessionAssignments (Global Query)
    match /{path=**}/unifiedSessionAssignments/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedSessionSteps Collection
    match /unifiedSessionSteps/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedSessionSteps (Global Query)
    match /{path=**}/unifiedSessionSteps/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedStepProgressions Collection
    match /unifiedStepProgressions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedStepProgressions (Global Query)
    match /{path=**}/unifiedStepProgressions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedWorkflowInstances Collection
    match /unifiedWorkflowInstances/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedWorkflowInstances (Global Query)
    match /{path=**}/unifiedWorkflowInstances/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedWorkflows Collection
    match /unifiedWorkflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // unifiedWorkflows (Global Query)
    match /{path=**}/unifiedWorkflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // user-workflows Collection
    match /user-workflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId) || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && (request.resource.data.userId == request.auth.uid || belongsToOrganization(request.resource.data.organizationId));
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId) || belongsToOrganization(resource.data.organizationId));
    }

    // user-workflows (Global Query)
    match /{path=**}/user-workflows/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId) || belongsToOrganization(resource.data.organizationId));
    }

    // userDirectReports Collection
    match /userDirectReports/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // userDirectReports (Global Query)
    match /{path=**}/userDirectReports/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // userMemoryProfiles Collection
    match /userMemoryProfiles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // userMemoryProfiles (Global Query)
    match /{path=**}/userMemoryProfiles/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // userPagePermissions Collection
    match /userPagePermissions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // userPagePermissions (Global Query)
    match /{path=**}/userPagePermissions/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // userPreferences Collection
    match /userPreferences/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId));
      allow create: if isAuthenticated() && request.resource.data.userId == request.auth.uid;
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId));
    }

    // userSettings Collection
    match /userSettings/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId));
      allow create: if isAuthenticated() && request.resource.data.userId == request.auth.uid;
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || isOwner(resource.data.userId));
    }

    // user_timecards Collection
    match /user_timecards/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // user_timecards (Global Query)
    match /{path=**}/user_timecards/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // workflow-templates Collection
    match /workflow-templates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // workflow-templates (Global Query)
    match /{path=**}/workflow-templates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // workflowDiagrams Collection
    match /workflowDiagrams/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // workflowDiagrams (Global Query)
    match /{path=**}/workflowDiagrams/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // workflowTemplates Collection
    match /workflowTemplates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
      allow create: if isAuthenticated() && belongsToOrganization(request.resource.data.organizationId);
      allow update, delete: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }

    // workflowTemplates (Global Query)
    match /{path=**}/workflowTemplates/{docId} {
      allow read: if isAuthenticated() && (isOwnerOrAdmin() || belongsToOrganization(resource.data.organizationId));
    }
    // ============================================================================
    // CATCH-ALL RULE
    // ============================================================================
    
    // Explicit deny for unmatched paths
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
